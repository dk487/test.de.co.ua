---
title: Firmata
date: 2022-09-12 20:49:38 +03:00
---

Я деякий час тому шукав готовий протокол для [керування залізом][1], такий щоб був простіше за G-коди. Схоже, що відповідь є.

Firmata. Ось що чудово підходить для блимання світлодіодом.

Правда, я поки не розібрався, наскільки мені цей протокол підходить. Поки бачу: все, що більш складне за світлодіод, може не дуже легко поєднуватися з тією Firmata.


Що тут добре
------------

Сьогодні я блимав світлодіодом, не написавши жодного рядку кода.

- Завантажив на Arduino скетч зі стандартних прикладів Firmata, а саме StandardFirmataPlus
- Запустив Node-RED з додатковими модулями:
  - `node-red-dashboard`, щоб зробити веб-інтерфейс;
  - [`node-red-contrib-johnny5`][2] для комунікації Firmata
- Далі достатньо мишкою намалювати просту схему

![Фрагмент знімку екрану Node-RED](/uploads/johnny5.png)

[Відео на YouTube: демонстрація роботи][3].

Повторююсь, жодного рядку кода!


Наступні кроки
--------------

Окей, я можу подати на LED 13 високий або низький рівень. А ще я можу написати код для Arduio, який цим світлодіодом буде блимати. Як там йдеться у стандартному прикладі Blink?

```c++
  digitalWrite(LED_BUILTIN, HIGH);
  delay(1000);
  digitalWrite(LED_BUILTIN, LOW);
  delay(1000);
```

Disclaimer: звісно, _насправді_ замість блокуючого `delay()` має бути перевірка таймеру з моменту останнього переключення стану світлодіоду і все таке. Але ви уявіть, що це псевдокод.

Тож, що маємо? Стандартний приклад блимає нестерпно повільно. Я можу захотіти замінити оці от 1000 мілісекунд на 500, наприклад. Або я можу вмикати світло на 100 мілісекунд, а потім темрява триватиме ще 900. Всі з цим колись експериментували, чи не так?

І я уявляю, що це у нас має бути такий особливий віртуальний прилад — «блималка» для керування фізичним світлодіодом. У цього віртуального приладу є два вхідних параметри, нуу наприклад, `delayHigh` та `delayLow`, кожен з них unsigned int. От ці два числа нехай передаються з хоста по протоколу Firmata.

Звісно, що можна написати всю цю програму на хості і керувати кожним окремим блиманням. Але я наполягаю, що мікроконтролер повинен напівавтономно займатися деякими складними процесами. Інакше нецікаво.

Піду гуглити RTFM, як це зробити.

[1]: /2022/08/11/pro-keruvannia-zalizom.html
[2]: https://flows.nodered.org/node/node-red-contrib-johnny5
[3]: https://www.youtube.com/watch?v=LYhN-YDwQuc
