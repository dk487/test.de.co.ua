---
title: Про керування залізом
date: 2022-08-11 23:52:08 +03:00
---

Дивлюся я на статтю у Вікіпедії про [G-коди][1] і сумно зітхаю. Там все керування в дюймах і міліметрах. І взагалі я не певен, що це добре підходить для масштабу Arduino.

Може є десь загальновідомий, усталений протокол керування по USB чимось на рівні окремих кроків в кроковому двигуні? Буквально, «встановити затримку між кроками 150 мс, зробити 4096 кроків уперед».

Якщо не знайду готового протоколу, доведеться видумувати щось своє.

Я деякий час для себе зробив один такий [примітивний протокол][2], і він був дуже, дуже жахливий. Користуватись можна через термінал: там, по задуму, треба вводити в десятковому виді через пробіл два цілих числа(бо вже є `Serial.parseInt()` для самих лінивих), тобто команду та аргумент, та тиснути Enter. Не робіть так :)

Треба придумати протокол з отакими властивостями:

 - обов'язково має бути текстовий варіант, щоб можна було руками в терміналі це відлагоджувати;
 - опціонально може бути більш ефективний бінарний варіант;
 - обов'язково має бути асинхронним, бо деякі команди виконуються тривалий час;
 - має бути двохстороннім: контролер має звітувати про стан виконання команд, а також за потреби передавати значення з сенсорів.

Нащо? Щоб можна було високорівневу логіку зробити десь у компі.

[1]: https://en.wikipedia.org/wiki/G-code
[2]: https://github.com/kastaneda/arduino_sandbox/blob/master/sketch_may28a_comm_stepper/sketch_may28a_comm_stepper.ino
