---
title: Кращий метод зробити чернетку
date: 2021-10-07 17:36:25 +03:00
---

Добавив у `Makefile` декілька прикольних дрібниць для роботи з чернетками.


Що це
-----

Що взагалі значить «чернетка» у контексті Jekyll?

 - Лежить не у `_posts`, а у `_drafts`
 - У чернетки зазвичай немає дати
 - Чернетки можна побачити, якщо зробити `jekyll build --drafts`
 - Чернетку можна закоммітити, але в продакшен вона не попаде

Для мене останній пункт є головним. Чернетки потрібні там, де мені треба буде зробити перерву у написанні посту. Ну, наприклад, якщо я пишу щось довге. Або якщо я не вирішив остаточно, коли і як я буду робити публікацію.

Під час звичайної публікації поста я створюю новий файл поста (користуючись [своїми методами автоматизації][1]), пишу в нього текст, роблю звичайні `git add`, `git commit` та `git push`, і все.

Пост, який _ще_ не потрапив в комміт і не пішов на продакшен — це «чернетка» у широкому сенсі цього слова, але не ота хитра хрінь, про яку далі.


Як це
-----

Спочатку я роблю щось таке:

```shell
$ slug=better-drafts make draft
echo "---\ntitle: better-drafts\nplaceholder: here\n---\n\n..." > _drafts/better-drafts.md
```

Це створює чернетку з заданим ім'ям файлу, якийсь мінімальний документ з front matter.

Щось таке:

```Markdown
---
title: better-drafts
date: 2021-10-07 17:36:25 +03:00
---

...
```

Чесно кажучи, `title` могло б виглядати краще, але я все одно його завжди редактую. Ну і ось цей от `placeholder: here` є компромісом, але без нього поки ніяк.

Далі я, зазвичай, хочу відкрити це в редакторі (в мене це найчастіше Geany). Щоб це зробити швидше, не витрачаючи зусиль на вибір або копіювання назви файлу, я роблю так команду:

```shell
$ make geany
git st --porcelain | egrep '(_posts|_drafts)' | cut -c 4- | xargs -L1 geany
```

Це просто запустить `geany _drafts/better-drafts.md` і відкриє нову вкладку.

Далі, звісно, я пишу собі контент. Якщо захочу подивитись, що там у мене виходить, чи добре все виглядає і чи не налажав я з Markdown, то для цього теж є готовий target:

```shell
$ make up
jekyll build --drafts --watch
```

Мені легше запам'ятати назви `make post`, `make draft` та навіть оце `make up`, аніж параметри `build --drafts --watch`. Ладно, пофіг. Це була сама тупа частина посту :)


Магія
-----

Пишу, роблю комміти для проміжних версій, відкладаю чернетку у довгий ящик. Нарешті, магія:

```shell
$ make pub
[ -f _drafts/better-drafts.md ]
mv _drafts/better-drafts.md _posts/2021/2021-10-07-better-drafts.md
sed -i "s/^placeholder: here/date: 2021-10-07 17:36:25 +03:00/" _posts/2021/2021-10-07-better-drafts.md
```

Ім'я файлу чернетки опціональне; якщо його не вказувати, буде використаний якийсь (рандомний) файл з `_drafts`, лол. (Це може мати сенс, тільки якщо у вас там лише одна чернетка).

Ну і, як бачите, дата встановлюється саме під час `make pub`.


Ну і що
-------

Не знаю, як це словами передати. Дуже приємно поєднувати типовий підхід генераторів статичних сайтів з усякою дрібною автоматизацією.

Коротше кажучи, [зацініть мій Makefile][2] :)

[1]: /2021/05/31/better-new-post.html
[2]: https://github.com/dk487/test.de.co.ua/blob/master/Makefile
